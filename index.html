<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Wettiq VIP – Tages Tipps vorbereiten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px;
    }
    .app {
      width: 100%;
      max-width: 1200px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 24px;
      padding: 24px 28px 28px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.65),
        0 0 0 1px rgba(148, 163, 184, 0.16);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }
    .title {
      font-size: 22px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f9fafb;
    }
    .subtitle {
      font-size: 14px;
      color: #9ca3af;
      margin-top: 4px;
    }
    .badge {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(251, 191, 36, 0.7);
      background: radial-gradient(circle at top left, #fbbf24 0, #92400e 60%);
      color: #111827;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      white-space: nowrap;
    }
    label {
      font-size: 14px;
      color: #d1d5db;
    }
    textarea {
      margin-top: 6px;
      width: 100%;
      min-height: 140px;
      resize: vertical;
      border-radius: 18px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.96);
      padding: 12px 14px;
      color: #e5e7eb;
      font-size: 14px;
      line-height: 1.5;
      outline: none;
    }
    textarea::placeholder {
      color: #6b7280;
    }
    .hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
      margin-bottom: 6px;
    }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(37, 99, 235, 0.55);
    }
    .btn-secondary {
      background: rgba(31, 41, 55, 0.95);
      color: #e5e7eb;
      border: 1px solid rgba(75, 85, 99, 0.9);
    }
    .btn-secondary:hover {
      background: rgba(31, 41, 55, 1);
    }
    .btn-danger {
      background: #b91c1c;
      color: #f9fafb;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .status {
      font-size: 12px;
      color: #9ca3af;
      min-height: 16px;
      margin-top: 4px;
    }
    .tips-list {
      margin-top: 20px;
    }
    .tips-header {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .tip-card {
      margin-top: 10px;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 18px;
      padding: 12px 14px 12px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .tip-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .tip-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #6b7280;
    }
    .tip-match {
      font-size: 15px;
      color: #e5e7eb;
    }
    .tip-text {
      font-size: 14px;
      color: #d1d5db;
    }
    .tip-meta {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 2px;
    }
    .tip-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }
    .quote-badge {
      font-size: 13px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.2);
      border: 1px solid rgba(45, 212, 191, 0.6);
      color: #a5f3fc;
    }
    .no-tips {
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <div class="title">Wettiq VIP</div>
        <div class="subtitle">Tages Tipps vorbereiten und als Karte anzeigen</div>
      </div>
      <div class="badge">vip testphase</div>
    </div>

    <div>
      <label for="rawInput">Rohdaten aus CleverTip einfügen</label>
      <textarea id="rawInput" placeholder="Beispiel für einen Tipp:

Türkei
VS
Bulgarien
TargetTIPP
Beide Teams treffen: Nein
Chart QUOTE
1.45"></textarea>
      <div class="hint">
        Du kopierst jeden Tipp einzeln aus CleverTip und fügst ihn hier ein.  
        Format mit 6 oder 7 Zeilen wie im Beispiel. Dann auf Tipp hinzufügen klicken.
      </div>
    </div>

    <div class="controls">
      <button id="addTipBtn" class="btn btn-primary">Tipp hinzufügen</button>
      <button id="showCardBtn" class="btn btn-secondary">Tageskarte anzeigen</button>
      <button id="clearAllBtn" class="btn btn-danger">Alle Tipps löschen</button>
    </div>

    <div id="status" class="status"></div>

    <div class="tips-list" id="tipsListContainer">
      <div class="tips-header">Aktuelle Tipps für die heutige Karte</div>
      <div id="tipsList"></div>
      <div id="noTipsHint" class="no-tips">Noch keine Tipps gespeichert. Füge oben deinen ersten Tipp ein.</div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "wettiq_tips";

    const rawInput = document.getElementById("rawInput");
    const addTipBtn = document.getElementById("addTipBtn");
    const showCardBtn = document.getElementById("showCardBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const statusEl = document.getElementById("status");
    const tipsList = document.getElementById("tipsList");
    const noTipsHint = document.getElementById("noTipsHint");

    function loadTips() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const data = JSON.parse(raw);
        return Array.isArray(data) ? data : [];
      } catch (e) {
        return [];
      }
    }

    function saveTips(tips) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tips));
    }

    function parseTip(rawText) {
      const lines = rawText
        .split("\n")
        .map(l => l.trim())
        .filter(l => l.length > 0);

      if (lines.length < 4) {
        throw new Error("Zu wenig Zeilen im Tipp");
      }

      const team1 = lines[0] || "";
      let vsIndex = lines.findIndex(l => l.toLowerCase() === "vs");
      let team2 = "";
      if (vsIndex >= 0 && vsIndex + 1 < lines.length) {
        team2 = lines[vsIndex + 1];
      } else if (lines.length >= 2) {
        team2 = lines[1];
      }

      const targetIndex = lines.findIndex(l => l.toLowerCase().includes("targettipp"));
      const quoteLabelIndex = lines.findIndex(l => l.toLowerCase().includes("quote"));

      let tipText = "";
      if (targetIndex >= 0) {
        for (let i = targetIndex + 1; i < lines.length; i++) {
          const l = lines[i];
          if (i === quoteLabelIndex) break;
          if (/^[0-9]+([.,][0-9]+)?$/.test(l)) continue;
          if (l.toLowerCase().includes("quote")) continue;
          tipText = l;
          break;
        }
      }
      if (!tipText) {
        // fallback: erste sinnvolle Zeile nach Teams
        for (let i = 2; i < lines.length; i++) {
          const l = lines[i];
          if (l.toLowerCase().includes("targettipp")) continue;
          if (l.toLowerCase().includes("quote")) continue;
          if (/^[0-9]+([.,][0-9]+)?$/.test(l)) continue;
          tipText = l;
          break;
        }
      }

      let quote = "-";
      if (quoteLabelIndex >= 0 && quoteLabelIndex + 1 < lines.length) {
        const q = lines[quoteLabelIndex + 1];
        quote = q.replace(",", ".").trim();
      } else {
        // letzte Zahl im Block
        for (let i = lines.length - 1; i >= 0; i--) {
          const l = lines[i];
          if (/^[0-9]+([.,][0-9]+)?$/.test(l)) {
            quote = l.replace(",", ".").trim();
            break;
          }
        }
      }

      return {
        team1: team1,
        team2: team2,
        tipText: tipText || "Tipp ohne Text",
        quote: quote
      };
    }

    function renderTips() {
      const tips = loadTips();
      tipsList.innerHTML = "";
      if (tips.length === 0) {
        noTipsHint.style.display = "block";
        return;
      }
      noTipsHint.style.display = "none";

      tips.forEach((tip, index) => {
        const card = document.createElement("div");
        card.className = "tip-card";

        const left = document.createElement("div");
        left.className = "tip-main";

        const label = document.createElement("div");
        label.className = "tip-label";
        label.textContent = "Tipp " + (index + 1);

        const match = document.createElement("div");
        match.className = "tip-match";
        match.textContent = (tip.team1 || "") + " – " + (tip.team2 || "");

        const text = document.createElement("div");
        text.className = "tip-text";
        text.textContent = "Tipp: " + (tip.tipText || "");

        const meta = document.createElement("div");
        meta.className = "tip-meta";
        meta.textContent = "Quote: " + (tip.quote || "-");

        left.appendChild(label);
        left.appendChild(match);
        left.appendChild(text);
        left.appendChild(meta);

        const right = document.createElement("div");
        right.className = "tip-right";

        const quoteBadge = document.createElement("div");
        quoteBadge.className = "quote-badge";
        quoteBadge.textContent = tip.quote ? "Quote " + tip.quote : "Quote -";

        const delBtn = document.createElement("button");
        delBtn.className = "btn btn-secondary";
        delBtn.style.padding = "4px 10px";
        delBtn.textContent = "Löschen";
        delBtn.addEventListener("click", () => {
          const current = loadTips();
          current.splice(index, 1);
          saveTips(current);
          renderTips();
        });

        right.appendChild(quoteBadge);
        right.appendChild(delBtn);

        card.appendChild(left);
        card.appendChild(right);

        tipsList.appendChild(card);
      });
    }

    addTipBtn.addEventListener("click", () => {
      const raw = rawInput.value.trim();
      if (!raw) {
        statusEl.textContent = "Bitte zuerst einen Tipp aus CleverTip einfügen";
        return;
      }
      try {
        const tip = parseTip(raw);
        const tips = loadTips();
        tips.push(tip);
        saveTips(tips);
        renderTips();
        rawInput.value = "";
        statusEl.textContent = "Tipp wurde gespeichert";
      } catch (e) {
        statusEl.textContent = "Fehler beim Lesen des Tipps. Prüfe das Format";
      }
    });

    showCardBtn.addEventListener("click", () => {
      const tips = loadTips();
      if (tips.length === 0) {
        statusEl.textContent = "Keine Tipps vorhanden. Bitte zuerst mindestens einen Tipp hinzufügen";
        return;
      }
      window.location.href = "karte.html";
    });

    clearAllBtn.addEventListener("click", () => {
      saveTips([]);
      renderTips();
      statusEl.textContent = "Alle Tipps wurden gelöscht";
    });

    renderTips();
  </script>
</body>
</html>
